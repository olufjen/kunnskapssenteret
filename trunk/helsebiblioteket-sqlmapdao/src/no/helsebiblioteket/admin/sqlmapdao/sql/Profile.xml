<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap
	PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
	"http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="Profile">
	<typeAlias alias="profile" type="no.helsebiblioteket.admin.domain.Profile"/>
	<resultMap id="getProfileResultMap" class="profile">
		<result property="id" column="profile_id" />
		<result property="receiveNewsletter" column="receive_newsletter" />
		<result property="participateSurvey" column="participateSurvey" />
		<result property="lastChanged" column="last_changed" />
	</resultMap>
	<select id="getProfileById" resultMap="getProfileResultMap" parameterClass="integer">
		select profile_id, receive_newsletter, participate_survey, last_changed
		from tbl_profile
		where profile_id = #profileId#;
	</select>
	<select id="getProfileList" resultMap="getProfileResultMap" parameterClass="integer">
		select profile_id, receive_newsletter, participate_survey, last_changed
		from tbl_profile;
	</select>
	<insert id="insertProfile" parameterClass="profile">
		<selectKey resultClass="int" keyProperty="id">
			SELECT nextval('tbl_profile_profile_id_seq') as id;
		</selectKey>
		insert into tbl_profile
		(profile_id, receive_newsletter, participate_survey, last_changed) 
		values 
		(#id#, #receiveNewsletter#, #participateSurvey#, now());
	</insert>
	<update id="updateProfile" parameterClass="profile">
		update tbl_profile
		set receive_newsletter = #receiveNewsletter#
		participate_survey = #participateSurvey#
		last_changed = now()
		where profile_id = #id# and 
    	last_changed = #lastChanged#;
	</update>
</sqlMap>