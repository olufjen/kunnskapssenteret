<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap
	PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
	"http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="OrganizationName">
	<typeAlias alias="OrganizationName" type="no.helsebiblioteket.admin.domain.OrganizationName"/>
	<cacheModel id="OrganizationNameCache" type="LRU" readOnly="false" serialize="true">
		<flushInterval hours="24"/>
		<flushOnExecute statement="insertOrganizationName"/>
		<flushOnExecute statement="updateOrganizationName"/>
		<flushOnExecute statement="deleteOrganizationName"/>
		<property name="size" value="1000" />
	</cacheModel>
	<resultMap id="OrganizationNameMap" class="OrganizationName">
		<result property="id" column="org_unit_name_id" />
		<result property="languageCode" column="language_code" />
		<result property="name" column="name" />
		<result property="orgUnitId" column="org_unit_id" />
		<result property="category" column="category" />
		<result property="lastChanged" column="last_changed" />
	</resultMap>
	<insert id="insertOrganizationName" parameterClass="OrganizationName">
		<selectKey resultClass="int" keyProperty="id">
			SELECT nextval('tbl_org_unit_name_org_unit_name_id_seq') as id;
		</selectKey>
		insert into tbl_org_unit_name (org_unit_name_id, language_code, name, org_unit_id, category, last_changed)
		values (#id#, #languageCode#, #name#, #orgUnitId#, #category#, now());
	</insert>
	<update id="updateOrganizationName" parameterClass="OrganizationName">
		update tbl_org_unit_name set
			language_code = #languageCode#,
			name = #name#,
			org_unit_id = #orgUnitId#,
			category = #category#,
    	  	last_changed = now()
    	where org_unit_name_id = #id# and last_changed = #lastChanged#;
  	</update>
	<delete id="deleteOrganizationName" parameterClass="OrganizationName">
  		delete from tbl_org_unit_name where org_unit_name_id = #id# and last_changed = #lastChanged#
	</delete>
	<select id="getOrganizationNameById" cacheModel="OrganizationNameCache" resultMap="OrganizationNameMap" parameterClass="OrganizationName">
		select org_unit_name_id, language_code, name, org_unit_id, category, last_changed
		from tbl_org_unit_name
		where org_unit_name_id = #id#;
	</select>
	<select id="getOrganizationNameListByOrganization" cacheModel="OrganizationNameCache" resultMap="OrganizationNameMap" parameterClass="integer">
		select org_unit_name_id, language_code, name, org_unit_id, category, last_changed
		from tbl_org_unit_name
		where org_unit_id = #orgUnitId#;
	</select>
</sqlMap>
