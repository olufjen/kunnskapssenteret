<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap
	PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
	"http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="UserRole">
	<typeAlias alias="UserRoleLine" type="no.helsebiblioteket.admin.domain.line.UserRoleLine"/>
	<cacheModel id="UserRoleLineCache" type="LRU" readOnly="false" serialize="true">
		<flushInterval hours="24"/>
		<flushOnExecute statement="insertUserRole"/>
		<flushOnExecute statement="deleteUserRole"/>
		<property name="size" value="1000" />
	</cacheModel>
	<resultMap id="UserRoleLineMap" class="UserRoleLine">
		<result property="userRoleId" column="user_role_id" />
		<result property="userId" column="user_id" />
		<result property="lastChanged" column="last_changed" />
	</resultMap>
	<insert id="insertUserRole" parameterClass="UserRoleLine">
		insert into tbl_user_role
		(user_role_id, user_id, last_changed)
		values 
		(#userRoleId#, #userId#, now());
	</insert>
	<delete id="deleteUserRole" parameterClass="UserRoleLine">
		delete from tbl_user_role
		where user_role_id = #userRoleId# and user_id = #userId#
	</delete>
	<select id="getUserRoleLineByUserRoleLine" cacheModel="UserRoleLineCache" resultMap="UserRoleLineMap" parameterClass="UserRoleLine">
		select 
			user_role_id,
			user_id,
			last_changed
		from tbl_user_role
		where user_id = #userId# and user_role_id = #userRoleId#;
	</select>
	<select id="getUserRoleListByUserId" cacheModel="UserRoleLineCache" resultMap="UserRoleLineMap" parameterClass="integer">
		select 
			user_role_id, 
			user_id,
			last_changed
		from tbl_user_role
		where user_id = #userId#;
	</select>
</sqlMap>
