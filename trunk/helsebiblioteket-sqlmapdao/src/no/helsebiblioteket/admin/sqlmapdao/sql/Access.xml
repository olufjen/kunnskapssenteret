<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap
	PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
	"http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="Access">
	<typeAlias alias="Access" type="no.helsebiblioteket.admin.domain.Access"/>
	<resultMap id="getAccessResultMap" class="access">
		<result property="id" column="access_id" />
		<result property="supplierSource.resourceId" column="resource_id" />
		<result property="type.id" column="access_type_id" />
		<!--<result property="userId" column="user_id" />-->
		<!--<result property="userRoleId" column="user_role_id" />-->
		<result property="validFrom" column="valid_from" />
		<result property="validTo" column="valid_to" />
		
		<!--<result property="orgTypeId" column="org_type_id" />-->
		<!--<result property="organization.id" column="org_unit_id" />-->
		<result property="organizationAsResource.id" column="org_unit_as_resource_id" />
		<result property="lastChanged" column="last_changed" />
	</resultMap>
	<select id="getAccessById" resultMap="getAccessResultMap" parameterClass="integer">
		select 
			access_id, 
			access_type_id, 
			resource_id, 
			user_id, 
			user_role_id, 
			valid_from, 
			valid_to, 
			org_type_id, 
			org_unit_id, 
			org_unit_as_resource_id,
			last_changed
		from tbl_access
		where access_id = #accessId#;
	</select>
	<select id="getAccessListByUserId" resultMap="getAccessResultMap" parameterClass="integer">
		select access_id, access_type_id, resource_id, user_id, user_role_id, valid_from, valid_to, org_type_id, org_unit_id, org_unit_as_resource_id, last_changed
		from tbl_access
		where user_id = #userId#;
	</select>
	<select id="getAccessListByUserRoleId" resultMap="getAccessResultMap" parameterClass="integer">
		select access_id, access_type_id, resource_id, user_id, user_role_id, valid_from, valid_to, org_type_id, org_unit_id, org_unit_as_resource_id, last_changed
		from tbl_access
		where user_role_id = #userRoleId#;
	</select>
	<select id="getAccessListByOrganizationTypeId" resultMap="getAccessResultMap" parameterClass="integer">
		select access_id, access_type_id, resource_id, user_id, user_role_id, valid_from, valid_to, org_type_id, org_unit_id, org_unit_as_resource_id, last_changed
		from tbl_access
		where org_type_id = #organizationTypeId#;
	</select>
	<select id="getAccessListByOrganizationId" resultMap="getAccessResultMap" parameterClass="integer">
		select access_id, access_type_id, resource_id, user_id, user_role_id, valid_from, valid_to, org_type_id, org_unit_id, org_unit_as_resource_id, last_changed
		from tbl_access
		where org_unit_id = #organizationId#;
	</select>
	
	<!-- TODO: finish  
	<insert id="insertAccess" parameterClass="access">
		<selectKey resultClass="int" keyProperty="id">
			SELECT nextval('tbl_ip_address_ip_address_id_seq') as id;
		</selectKey>
		insert into tbl_access (
			access_id, 
			access_type_id, 
			resource_id, 
			user_id, 
			user_role_id, 
			valid_from, 
			valid_to, 
			org_type_id, 
			org_unit_id, 
			org_unit_as_resource_id,
			last_changed
			) 
		values (#id#, #type.id#, ##, ##, ##, ##, ##, ##, ##, ##, now());
	</insert>-->
	<delete id="deleteAccess" parameterClass="access">
  		delete from tbl_access
  		where
  		access_id = #id#;
  </delete>
</sqlMap>
