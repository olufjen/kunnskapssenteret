<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap
	PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
	"http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="ContactInformation">
	<typeAlias alias="contactInformation" type="no.helsebiblioteket.admin.domain.ContactInformation"/>
	<resultMap id="getContactInformationResultMap" class="contactInformation">
		<result property="postalAddress" column="postal_address" />
		<result property="postalCode" column="postal_code" />
		<result property="telephoneNumber" column="telephone_number" />
		<result property="postalLocation" column="postal_location" />
		<result property="email" column="email" />
		<result property="contactInformationId" column="contact_information_id" />
		<result property="lastChanged" column="last_changed" />
	</resultMap>
	<insert id="insertContactInformation" parameterClass="contactInformation">
		<selectKey resultClass="int" keyProperty="contactInformationId">
			SELECT nextval('tbl_contact_information_contact_information_id_seq') as contactInformationId;
		</selectKey>
		insert into tbl_contact_information 
		(contact_information_id, postal_address, postal_code, postal_location, telephone_number, email, last_changed) 
		values 
		(#contactInformationId#, #postalAddress#, #postalCode#, #postalLocation#, #telephoneNumber#, #email#, now());
	</insert>
	<update id="updateContactInformation" parameterClass="contactInformation">
		update tbl_contact_information set
      	postal_address = #postalAddress#,
      	postal_code = #postalCode#,
      	postal_location = #postalLocation#,
      	telephone_number = #telephoneNumber#,
      	email = #email#,
      	last_changed = now()
    	where contact_information_id = #contactInformationId# and
    	last_changed = #lastChanged#;
	</update>
	<delete id="deleteContactInformation" parameterClass="integer">
  		delete from tbl_contact_information
  		where
  		contact_information_id = #contactInformationId#;
	</delete>
	<select id="getContactInformationById" resultMap="getContactInformationResultMap" parameterClass="integer">
		select contact_information_id, postal_address, postal_code, telephone_number, postal_location, email, last_changed
		from tbl_contact_information
		where contact_information_id = #contactInformationId#;
	</select>
	<select id="getContactInformationByPerson" resultMap="getContactInformationResultMap" parameterClass="integer">
		select contact_information_id, postal_address, postal_code, telephone_number, postal_location, email, last_changed
		from tbl_contact_information
		where contact_information_id = (select contact_information_id from tbl_person where person_id = #personId#);
	</select>
	<select id="getContactInformationByOrganization" resultMap="getContactInformationResultMap">
		select contact_information_id, postal_address, postal_code, telephone_number, postal_location, email, last_changed
		from tbl_contact_information
		where contact_information_id = (select contact_information_id from tbl_org_unit where org_unit_id = #orgUnitId#);
	</select>
</sqlMap>
