<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap
	PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
	"http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="IpRange">
	<typeAlias alias="ipRange" type="no.helsebiblioteket.admin.domain.IpRange"/>
	<resultMap id="getIpRangeResultMap" class="ipRange">
		<result property="id" column="ip_address_id" />
		<result property="ipAddressFrom" column="ip_address_from" />
		<result property="ipAddressTo" column="ip_address_to" />
		<result property="organizationId" column="org_unit_id" />
		<result property="lastChanged" column="last_changed" />
	</resultMap>
	<select id="getIpRangeById" resultMap="getIpRangeResultMap" parameterClass="integer">
		select ip_address_id, ip_address_from, ip_address_to, org_unit_id, last_changed
		from tbl_ip_address
		where ip_address_id = #ipAddressId#;
	</select>
	<select id="getIpRangeList" resultMap="getIpRangeResultMap">
		select ip_address_id, ip_address_from, ip_address_to, org_unit_id, last_changed
		from tbl_ip_address
	</select>
	<select id="getIpRangeListByOrganizationId" resultMap="getIpRangeResultMap" parameterClass="integer">
		select ip_address_id, ip_address_from, ip_address_to, org_unit_id, last_changed
		from tbl_ip_address
		where org_unit_id = #organizationId#
	</select>
	<insert id="insertIpRange" parameterClass="ipRange">
		<selectKey resultClass="int" keyProperty="id">
			SELECT nextval('tbl_ip_address_ip_address_id_seq') as id;
		</selectKey>
		insert into tbl_ip_address (ip_address_id, ip_address_from, ip_address_to, org_unit_id, last_changed) 
		values (#id#, #ipAddressFrom#, #ipAddressTo#, #organizationId#, now());
	</insert>
	<update id="updateIpRange" parameterClass="ipRange">
		update tbl_ip_address set
		ip_address_from = #ipAddressFrom#,
		ip_address_to = #ipAddressTo#,
		org_unit_id = #organizationId#,
      	last_changed = now()
    	where ip_address_id = #id# and
    	last_changed = #lastChanged#;
  </update>
  <delete id="deleteIpRange" parameterClass="ipRange">
		delete from tbl_ip_address
		where ip_address_id = #id#;
  </delete>
</sqlMap>
