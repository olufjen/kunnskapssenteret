<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap
	PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
	"http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="Role">
	<typeAlias alias="role" type="no.helsebiblioteket.admin.domain.Role"/>
	<typeAlias alias="roleSystemCompositeKey" type="no.helsebiblioteket.admin.dao.keys.RoleSystemCompositeKey"/>
	<cacheModel id="RoleCache" type="LRU" readOnly="false" serialize="true">
		<flushInterval hours="24"/>
		<property name="size" value="1000" />
	</cacheModel>
	<resultMap id="getRoleResultMap" class="role">
		<result property="name" column="name" />
		<result property="description" column="descr" />
		<result property="id" column="user_role_id" />
		<result property="system.id" column="system_id" />
		<result property="system.key.value" column="system_key" />
		<result property="key.value" column="role_key" />
	</resultMap>
	<select id="getRoleByKeySystem" cacheModel="RoleCache" resultMap="getRoleResultMap" parameterClass="roleSystemCompositeKey">
		select
			role.name,
			role.descr,
			role.user_role_id,
			role.system_id,
			role.key as role_key,
			system.key as system_key
		from tbl_user_role_reg as role inner join tbl_system_reg as system on 
		   role.system_id = system.system_id
		where role.key = #roleKey# and system.key = #systemKey#;
	</select>
	<select id="getRoleListBySystemId" cacheModel="RoleCache" resultMap="getRoleResultMap" parameterClass="integer">
		select
			name,
			descr,
			user_role_id,
			system_id,
			key as role_key,
			key as system_key
		from tbl_user_role_reg
		where system_id = #id#;
	</select>
	<select id="getRoleById" cacheModel="RoleCache" resultMap="getRoleResultMap" parameterClass="integer">
		select
			name,
			descr,
			user_role_id,
			system_id,
			key as role_key,
			key as system_key
		from tbl_user_role_reg
		where user_role_id = #roleId#;
	</select>
</sqlMap>
