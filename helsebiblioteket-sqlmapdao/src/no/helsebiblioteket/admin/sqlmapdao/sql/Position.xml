<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="Position">
	<typeAlias alias="Position" type="no.helsebiblioteket.admin.domain.Position"/>
	<resultMap id="PositionResultMap" class="Position">
		<result property="id" column="position_type_id" />
		<result property="description" column="descr" />
		<result property="name" column="name" />
		<result property="key.value" column="key" />
		<result property="organizationType.orgTypeId" column="org_type_id" />
	</resultMap>
	<insert id="insertPosition" parameterClass="Position">
		<selectKey resultClass="int" keyProperty="id">
			SELECT nextval('tbl_position_type_reg_position_type_id_seq') as id;
		</selectKey>
		insert into tbl_position_type_reg(
			position_type_id,
			descr,
			name,
			key,
			org_type_id
		)values (#id#, #description#, #name#, #key.value#, #organizationType.orgTypeId#);
	</insert>
	<update id="updatePosition" parameterClass="Position">
		update tbl_position_type_reg set
			position_type_id = #id#
			descr = #description#
			name = #name#
			key = #key.value#
			org_type_id = #organizationType.orgTypeId#
  		where
  			position_type_id = #id#
	</update>
	<delete id="deletePosition" parameterClass="integer">
  		delete from tbl_position_type_reg where position_type_id = #id# and date_trunc('milliseconds', last_changed) = #lastChanged#
    </delete>
	<select id="getPositionByKey" resultMap="PositionResultMap" parameterClass="string">
		select position_type_id, descr, name, key, org_type_id
		from tbl_position_type_reg
		where key = #key#
	</select>
	<select id="getPositionById" resultMap="PositionResultMap" parameterClass="integer">
		select position_type_id, descr, name, key, org_type_id
		from tbl_position_type_reg
		where position_type_id = #id#
	</select>
	<select id="getPositionListAll" resultMap="PositionResultMap">
		select position_type_id, descr, name, key, org_type_id
		from tbl_position_type_reg
	</select>
</sqlMap>
